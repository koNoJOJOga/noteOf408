# 物理层+数据链路层+补充

## FTP

&emsp;&emsp;&ensp;FTP的通过**两种类型的TCP连接**完成数据传输过程：
&emsp;&emsp;&ensp;**控制连接**：用于在两主机之间传输控制信息，如1.用户标识信息，2.口令信息，3.改变远程目录命令，以及“存放(put)”和“获取(get)”文件的命令等。
&emsp;&emsp;&ensp;**数据连接**：仅用于实际发送一个文件数据的过程。

<div style=" margin: 0 auto; max-width: 30%;">
<img src="image.png" alt="Alt text" style="margin-top: 0; margin-bottom: 10px;" align="center">
</div>

### FTP的数据传输流程

&emsp;&emsp;以连接FTP服务器并下载文件a，b为例：

<div style=" margin: 0 auto; max-width: 60%;">
<img src="image-1.png" alt="Alt text" style="margin-top: 0; margin-bottom: 10px;" align="center">
</div>

1. 客户机通过端口12345(假定)FTP向服务器21端口发起TCP连接请求，并建立连接。
2. 客户机12345端口和FTP服务器21端口传输一些必要口令和用户信息，并完成登录

<div style=" margin: 0 auto; max-width: 40%;">
<img src="image-2.png" alt="Alt text" style="margin-top: 0; margin-bottom: 10px;" align="center">
</div>

3. 客户机发起对文件a的下载请求，并告知服务器，客户机采用54321端口和FTP进行数据连接。
4. FTP服务器的20端口向54321端口发起TCP连接。
5. FTP服务器通过20端口向客户机传输数据。
6. FTP服务器20端口向客户机54321端口断开连接，下载完毕。

<div style=" margin: 0 auto; max-width: 40%;">
<img src="image-3.png" alt="Alt text" style="margin-top: 0; margin-bottom: 10px;" align="center">
</div>

7. 客户机发起对文件b的下载请求，并告知服务器，客户机采用56789端口和FTP进行数据连接
8. FTP服务器的20端口向56789端口发起TCP连接
9. FTP服务器通过20端口向客户机传输数据
10. FTP服务器20端口向客户机56789端口断开连接，下载完毕。

<div style=" margin: 0 auto; max-width: 20%;">
<img src="image-4.png" alt="Alt text" style="margin-top: 0; margin-bottom: 10px;" align="center">
</div>

11. 客户机结束下载需求，通过12345端口向服务器的21端口发起断开连接请求。
12. FTP服务器的21端口发起FIN=1的帧，开始四次挥手过程，连接断开。
